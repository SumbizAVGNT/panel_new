{# ===== SERVERS ===== #}
<div class="card glass p-3 p-md-4 mt-3">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h2 class="h5 m-0">Servers</h2>
  </div>

  <form method="post"
        action="{{ url_for('admin.servers_add') }}"
        enctype="multipart/form-data"
        class="row gy-2 gx-2">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">

    <div class="col-12 col-md-3">
      <label class="form-label">Name</label>
      <input class="form-control" name="name" placeholder="prod-1" required>
    </div>

    <div class="col-12 col-md-3">
      <label class="form-label">Host</label>
      <input class="form-control" name="host" placeholder="1.2.3.4" required>
    </div>

    <div class="col-6 col-md-2">
      <label class="form-label">Port</label>
      <input class="form-control" name="port" type="number" min="1" max="65535" value="22" required>
    </div>

    <div class="col-6 col-md-2">
      <label class="form-label">Username</label>
      <input class="form-control" name="username" placeholder="root" required>
    </div>

    <div class="col-12 col-md-2">
      <label class="form-label">Password</label>
      <input class="form-control" name="password" type="password" placeholder="optional">
    </div>

    <div class="col-12 col-md-9">
      <label class="form-label mb-1">SSH key (optional)</label>
      <input class="form-control" type="file" name="ssh_key" accept=".pem,.key,.txt,.pub">
    </div>

    {# Кнопку выравниваем по нижнему краю первой строки, независимо от текста-пояснения #}
    <div class="col-12 col-md-3 d-grid align-self-end">
      <button class="btn btn-primary" type="submit">
        <i class="bi bi-plus-circle me-1"></i>Add server
      </button>
    </div>

    {# Перенесли help-текст отдельной строкой, чтобы он не «толкал» кнопку вниз #}
    <div class="col-12">
      <div class="form-text mt-1">
        OpenSSH private key. Если задан, пароль можно оставить пустым.
      </div>
    </div>
  </form>

  <div class="row g-3 mt-2">
    {% for s in servers %}
    <div class="col-12 col-md-6 col-xl-4">
      <div class="card bg-transparent border-secondary-subtle h-100">
        <div class="card-body">
          <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-2">
              <div class="rounded-2 bg-dark-subtle p-2"><i class="bi bi-hdd-network"></i></div>
              <div>
                <div class="fw-semibold">{{ s.name }}</div>
                <div class="text-secondary small">{{ s.host }}:{{ s.port }} · {{ s.username }}</div>
              </div>
            </div>
            <span class="badge rounded-pill {{ 'bg-success' if s.last_status=='online' else ('bg-danger' if s.last_status=='offline' else 'bg-secondary')}} text-uppercase">{{ s.last_status or 'unknown' }}</span>
          </div>
          <div class="mt-2 small text-secondary">
            <div><span class="text-light">Uptime:</span> {{ s.last_uptime or '—' }}</div>
            <div><span class="text-light">Checked:</span> {{ s.last_checked or '—' }}</div>
          </div>
          <div class="mt-3 d-flex gap-2">
            <form class="d-inline" method="post" action="{{ url_for('admin.servers_check', server_id=s.id) }}">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <button class="btn btn-outline-light btn-sm" type="submit"><i class="bi bi-activity me-1"></i>Check</button>
            </form>
            <form class="d-inline" method="post" action="{{ url_for('admin.servers_delete', server_id=s.id) }}" onsubmit="return confirm('Delete this server?');">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
              <button class="btn btn-outline-danger btn-sm" type="submit"><i class="bi bi-trash me-1"></i>Delete</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12"><div class="text-secondary">No servers yet. Add your first server above.</div></div>
    {% endfor %}
  </div>
</div>
