<section id="kits-root" class="vstack gap-3">
  <style>
    /* ===== Kits (scoped) ===== */
    #kits-root .glass{background:rgba(13,17,23,.55);border:1px solid rgba(148,163,184,.18);backdrop-filter:blur(8px);border-radius:16px}
    #kits-root .head-bar{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    #kits-root .pill{border:1px solid rgba(148,163,184,.25);border-radius:999px;padding:.2rem .6rem;color:#cbd5e1;background:rgba(2,6,23,.35);font-size:.78rem}
    #kits-root .hint{color:#94a3b8;font-size:.86rem}
    #kits-root .sec-title{font-weight:700;color:#e5e7eb}
    #kits-root .dim{color:#94a3b8;font-size:.86rem}

    /* Builder grid */
    #kits-root .builder{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
    @media (max-width: 1100px){#kits-root .builder{grid-template-columns:1fr}}
    #kits-root .slot-grid{display:grid;grid-template-columns:repeat(9,1fr);gap:10px}
    #kits-root .slot{position:relative;background:rgba(2,6,23,.5);border:1px dashed rgba(148,163,184,.3);border-radius:12px;min-height:62px;display:grid;place-items:center;color:#cbd5e1;cursor:pointer;transition:.15s}
    #kits-root .slot:hover{border-color:rgba(148,163,184,.5);transform:translateY(-1px)}
    #kits-root .slot.active{outline:2px solid #60a5fa;outline-offset:2px}
    #kits-root .slot .qty{position:absolute;right:6px;bottom:4px;background:rgba(15,23,42,.8);border:1px solid rgba(148,163,184,.35);border-radius:8px;padding:2px 6px;font-size:.72rem}
    #kits-root .slot .name{max-width:90%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    #kits-root .slot .icon{width:30px;height:30px;image-rendering:pixelated;border-radius:6px;border:1px solid rgba(148,163,184,.25);background:rgba(15,23,42,.6);display:block}

    /* Items catalog */
    #kits-root .items-grid{display:grid;grid-template-columns:repeat(8,1fr);gap:10px}
    @media (max-width:1400px){#kits-root .items-grid{grid-template-columns:repeat(6,1fr)}}
    @media (max-width:1100px){#kits-root .items-grid{grid-template-columns:repeat(5,1fr)}}
    @media (max-width:900px){#kits-root .items-grid{grid-template-columns:repeat(4,1fr)}}
    @media (max-width:680px){#kits-root .items-grid{grid-template-columns:repeat(3,1fr)}}
    #kits-root .item{display:flex;align-items:center;gap:8px;padding:8px;border:1px solid rgba(148,163,184,.2);border-radius:12px;background:rgba(13,17,23,.55);cursor:grab}
    #kits-root .item:active{cursor:grabbing}
    #kits-root .item .icon{width:28px;height:28px;image-rendering:pixelated;border-radius:6px;border:1px solid rgba(148,163,184,.25);background:rgba(15,23,42,.6)}
    #kits-root .item .n{font-size:.86rem;color:#e5e7eb;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    /* Saved kits list */
    #kits-root .kit-row{display:flex;align-items:center;gap:10px;padding:8px;border:1px solid rgba(148,163,184,.18);border-radius:12px;background:rgba(13,17,23,.45)}
    #kits-root .kit-row:hover{border-color:rgba(148,163,184,.35)}
    #kits-root .kit-row .name{font-weight:700}
    #kits-root .right-col{display:grid;grid-template-rows:auto 1fr;gap:12px}

    /* drag feedback */
    #kits-root .slot.drag-over{background:rgba(96,165,250,.08);border-style:solid}

    /* skeleton */
    #kits-root .skeleton{position:relative;overflow:hidden;background:rgba(148,163,184,.12);border-radius:10px;min-height:40px}
    #kits-root .skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);transform:translateX(-100%);animation:sk 1.05s infinite}
    @keyframes sk{to{transform:translateX(100%)}}

    /* Autocomplete + chips */
    #kits-root .dd{position:relative;z-index:50}              /* свой контекст */
    #kits-root .dd-list{
      position:absolute;left:0;right:0;top:calc(100% + 6px);
      background:#0b1220;border:1px solid rgba(148,163,184,.25);border-radius:10px;
      box-shadow:0 10px 24px rgba(0,0,0,.45);max-height:260px;overflow:auto;
      z-index:5000; pointer-events:auto;
    }
    #kits-root .dd-item{padding:.45rem .6rem;display:flex;justify-content:space-between;gap:.6rem;cursor:pointer}
    #kits-root .dd-item small{color:#94a3b8}
    #kits-root .dd-item:hover,#kits-root .dd-item.act{background:rgba(96,165,250,.12)}
    #kits-root .chips{position:relative;z-index:51}
    #kits-root .chip{display:inline-flex;align-items:center;gap:.35rem;padding:.25rem .5rem;border-radius:999px;border:1px solid rgba(148,163,184,.28);background:rgba(15,23,42,.6);margin:.25rem .25rem 0 0}
    #kits-root .chip .lvl{font-weight:700}
    #kits-root .chip .x{border:0;background:transparent;color:#e5e7eb;line-height:1;padding:0 .1rem;cursor:pointer}
    #kits-root #ench-input{border:1px solid rgba(148,163,184,.28);background:rgba(15,23,42,.55);color:#e5e7eb;border-radius:10px;padding:.48rem .6rem;width:100%}
  </style>

  <!-- Header -->
  <div class="glass p-3 head-bar">
    <div class="d-flex align-items-center gap-2">
      <span class="sec-title">Kits</span>
      <span class="pill"><span id="kit-stats">0 items</span></span>
      <span class="dim" id="kit-hint">создайте или выберите кит слева</span>
    </div>
    <div class="d-flex align-items-center gap-2">
      <button id="kit-new" class="btn btn-sm btn-outline-info"><i class="bi bi-plus-lg me-1"></i>Новый</button>
      <button id="kit-dup" class="btn btn-sm btn-outline-secondary" disabled><i class="bi bi-files me-1"></i>Дублировать</button>
      <button id="kit-save" class="btn btn-sm btn-success" disabled><i class="bi bi-check2-circle me-1"></i>Сохранить</button>
      <button id="kit-del" class="btn btn-sm btn-outline-danger" disabled><i class="bi bi-trash me-1"></i>Удалить</button>
    </div>
  </div>

  <!-- Builder -->
  <div class="builder">
    <!-- left: builder + catalog -->
    <div class="vstack gap-3">
      <div class="glass p-3">
        <div class="row g-2">
          <div class="col-md-6">
            <label class="form-label mb-1">Название кита</label>
            <input id="kit-name" class="form-control" placeholder="starter, vip, tools">
          </div>
          <div class="col-md-6">
            <label class="form-label mb-1">Описание (опц.)</label>
            <input id="kit-desc" class="form-control" placeholder="короткое описание">
          </div>
        </div>

        <div class="d-flex align-items-center justify-content-between mt-3 mb-1">
          <div class="sec-title">Слоты</div>
          <div class="d-flex align-items-center gap-2">
            <button id="slot-clear" class="btn btn-sm btn-outline-light" disabled><i class="bi bi-x-circle"></i> Очистить слот</button>
          </div>
        </div>
        <div id="slot-grid" class="slot-grid"></div>

        <div id="slot-editor" class="mt-3" hidden>
          <div class="d-flex align-items-center justify-content-between">
            <div class="sec-title">Редактор слота <span id="slot-no" class="pill">—</span></div>
            <div class="hint">клик по слоту — выбрать, перетянуть предмет — положить</div>
          </div>
          <div class="row g-2 mt-1">
            <div class="col-md-4">
              <label class="form-label mb-1">Количество</label>
              <div class="input-group">
                <button class="btn btn-outline-light" data-qty="-1">−</button>
                <input id="slot-qty" type="number" min="1" max="64" value="1" class="form-control">
                <button class="btn btn-outline-light" data-qty="+1">+</button>
              </div>
            </div>
            <div class="col-md-8">
              <label class="form-label mb-1">Отображаемое имя (опц.)</label>
              <div class="input-group">
                <input id="slot-dname" class="form-control" placeholder="Напр. &aStarter &fSword">
                <button id="dname-clear" class="btn btn-outline-secondary" title="Очистить имя"><i class="bi bi-eraser"></i></button>
              </div>
            </div>

            <!-- Enchants / attributes with autocomplete -->
            <div class="col-12">
              <label class="form-label mb-1">Enchant / Attr</label>
              <div class="dd">
                <input id="ench-input" placeholder="Начните печатать: sharp..., prot..., attack_damage..." autocomplete="off">
                <div id="ench-dd" class="dd-list d-none"></div>
              </div>
              <div id="slot-enchants" class="chips mt-2"></div>
              <div class="d-flex justify-content-between mt-1">
                <div class="form-text text-secondary">Enter — добавить выбранную подсказку; Backspace на пустом поле — удалить последний чип.</div>
                <button id="ench-clear" class="btn btn-sm btn-outline-secondary"><i class="bi bi-x-octagon me-1"></i>Очистить</button>
              </div>
              <input id="slot-extra" type="hidden" value="">
            </div>
          </div>
        </div>
      </div>

      <!-- Catalog -->
      <div class="glass p-3">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <div class="sec-title">Каталог предметов</div>
          <div class="d-flex align-items-center gap-2">
            <select id="ver-select" class="form-select form-select-sm" style="min-width:220px"></select>
            <div class="input-group input-group-sm" style="min-width:320px">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input id="item-search" class="form-control" placeholder="Поиск (id / name)">
              <button id="item-refresh" class="btn btn-outline-secondary" title="Обновить"><i class="bi bi-arrow-repeat"></i></button>
            </div>
          </div>
        </div>
        <div id="items-wrap" class="items-grid"></div>
        <div id="items-empty" class="text-secondary small mt-2" hidden>Ничего не найдено.</div>
      </div>
    </div>

    <!-- right: saved kits list -->
    <div class="right-col">
      <div class="glass p-3">
        <div class="d-flex align-items-center justify-content-between">
          <div class="sec-title">Сохранённые киты</div>
          <div class="dim" id="kits-count">—</div>
        </div>
        <div id="kits-list" class="vstack gap-2 mt-2">
          <div class="skeleton"></div>
          <div class="skeleton"></div>
          <div class="skeleton"></div>
        </div>
      </div>

      <div class="glass p-3">
        <div class="sec-title mb-1">Подсказки</div>
        <ul class="mb-0 text-secondary small">
          <li>Перетащите предмет из каталога на слот (1–27).</li>
          <li>Клик по слоту — редактирование количества, имени и чар.</li>
          <li>«Сохранить» станет активной, когда есть изменения.</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- toast zone -->
  <div id="kits-toasts" class="position-fixed bottom-0 end-0 p-3" style="z-index:1080"></div>
</section>
